# Ralph Wiggum

A CLI tool that runs Claude Code in an iterative loop until a completion promise is found.

## Overview

Ralph Wiggum wraps the `claude` CLI and executes your prompt in a loop. Each iteration verifies whether the previous one completed the task correctly. The loop continues until Claude signals completion with a promise tag (e.g., `<promise>DONE</promise>`), ensuring tasks are truly finished before stopping.

## Installation

### Prerequisites

- [Claude Code CLI](https://github.com/anthropics/claude-code) installed and configured

### Quick install (recommended)

**Linux / macOS:**

```bash
curl -fsSL https://raw.githubusercontent.com/nixuuu/ralph-wiggum-rs/master/install.sh | bash
```

**Windows (PowerShell):**

```powershell
irm https://raw.githubusercontent.com/nixuuu/ralph-wiggum-rs/master/install.ps1 | iex
```

The scripts download the latest prebuilt binary for your platform and install it to `~/.local/bin/`. If a prebuilt binary is not available, they fall back to building from source.

### Building from source

Requires Rust 1.85+ (edition 2024).

```bash
cargo build --release
```

The binary will be available at `target/release/ralph-wiggum`.

### Updating

```bash
ralph-wiggum --update
```

## Usage

```bash
ralph-wiggum --prompt "Your task description here"
```

### Command Line Options

| Option | Short | Default | Description |
|--------|-------|---------|-------------|
| `--prompt` | `-p` | (required) | The prompt/task to send to Claude |
| `--min-iterations` | `-m` | `1` | Minimum iterations before accepting promise |
| `--max-iterations` | `-n` | `0` (unlimited) | Maximum iterations (0 = unlimited) |
| `--promise` | | `done` | Completion promise text to look for |
| `--resume` | `-r` | | Resume from state file |
| `--state-file` | | `.claude/ralph-loop.local.md` | Path to state file |
| `--config` | `-c` | `.ralph.toml` | Path to config file |
| `--continue-session` | | | Continue conversation from previous iteration |
| `--update` | | | Update to the latest version |

### Examples

Basic usage:
```bash
ralph-wiggum --prompt "Write unit tests for the auth module"
```

With iteration limits:
```bash
ralph-wiggum --prompt "Refactor the database layer" --min-iterations 2 --max-iterations 5
```

Custom completion promise:
```bash
ralph-wiggum --prompt "Fix all linting errors" --promise "COMPLETE"
```

Resume an interrupted session:
```bash
ralph-wiggum --resume
```

## Configuration File

Create a `.ralph.toml` file in your project root to customize prompt handling:

```toml
[prompt]
# Text prepended to every prompt
prefix = "Follow the project coding standards."

# Text appended to every prompt
suffix = "Update CHANGELOG.md with your changes."
```

## Task-Based Development

Beyond single-prompt loops, Ralph Wiggum supports a full task-based workflow: define a PRD, generate a structured task list, and let Claude iterate through each task until the project is complete.

**Workflow:** PRD → `PROGRESS.md` → iterative execution → finished project.

### Commands

#### `task prd` — Generate project files from a PRD

Parses your requirements document and generates structured project files that drive the development loop.

```bash
# From a file
ralph-wiggum task prd --file requirements.md

# From inline text
ralph-wiggum task prd --prompt "Build a REST API with auth and rate limiting"

# From stdin
cat PRD.md | ralph-wiggum task prd

# With custom output directory and model
ralph-wiggum task prd --file requirements.md --output-dir ./project --model claude-sonnet-4-5-20250929
```

| Option | Short | Description |
|--------|-------|-------------|
| `--file` | `-f` | Path to PRD file |
| `--prompt` | `-p` | PRD content as text |
| `--output-dir` | `-o` | Output directory (default: current directory) |
| `--model` | `-m` | Claude model to use |

**Generated files:**
- `PROGRESS.md` — structured task list with statuses
- `SYSTEM_PROMPT.md` — system prompt for the development loop
- `CURRENT_TASK.md` — currently active task details
- `CLAUDE.md` — project conventions (only if not already present)
- `CHANGENOTES.md`, `IMPLEMENTATION_ISSUES.md`, `OPEN_QUESTIONS.md` — auxiliary tracking files

Input priority: `--file` > `--prompt` > stdin.

#### `task continue` — Run the development loop

Reads `PROGRESS.md` and `SYSTEM_PROMPT.md`, then enters the iterative loop — picking up the next task, executing it, and moving on until all tasks are complete.

```bash
ralph-wiggum task continue
```

No arguments needed. Iteration limits are computed automatically from remaining tasks:
- `min_iterations` = number of remaining tasks (at least 1)
- `max_iterations` = remaining + 5 (buffer for complex tasks)

The status bar displays three lines: iteration metrics, current task info, and a progress gauge.

**Requires:** `PROGRESS.md` and `SYSTEM_PROMPT.md` in the project root (generated by `task prd`).

#### `task add` — Add new tasks to the project

Appends new tasks to an existing `PROGRESS.md`, preserving existing numbering and task states.

```bash
# From a file
ralph-wiggum task add --file new-requirements.md

# From inline text
ralph-wiggum task add --prompt "Add WebSocket support and real-time notifications"

# From stdin
echo "Add logging middleware" | ralph-wiggum task add
```

| Option | Short | Description |
|--------|-------|-------------|
| `--file` | `-f` | Path to requirements file |
| `--prompt` | `-p` | Requirements as text |
| `--model` | `-m` | Claude model to use |

If a state file exists (`.claude/ralph-loop.local.md`), iteration limits are automatically updated to account for the new tasks.

#### `task status` — Show progress dashboard

Displays a quick overview of project progress without running any tasks.

```bash
ralph-wiggum task status
```

Output includes:
- Task counts by status (done, in progress, blocked, todo)
- Currently active task
- Visual progress bar with percentage

### PROGRESS.md Format

Tasks in `PROGRESS.md` follow this format:

```
- [S] ID [component] Task description
```

Where `S` is the status marker:

| Marker | Status | Meaning |
|--------|--------|---------|
| `[ ]` | Todo | Not yet started |
| `[x]` | Done | Completed |
| `[~]` | In Progress | Currently being worked on |
| `[!]` | Blocked | Cannot proceed |

Example:
```markdown
- [x] T01 [auth] Set up JWT authentication
- [~] T02 [api] Implement user CRUD endpoints
- [ ] T03 [api] Add rate limiting middleware
- [!] T04 [deploy] Configure CI/CD pipeline
```

### Task Configuration

Customize task behavior in `.ralph.toml`:

```toml
[task]
progress_file = "PROGRESS.md"          # Path to progress file
system_prompt_file = "SYSTEM_PROMPT.md" # Path to system prompt
current_task_file = "CURRENT_TASK.md"   # Path to current task file
output_dir = "."                        # Output directory for generated files
default_model = "claude-sonnet-4-5-20250929"  # Default Claude model
adaptive_iterations = true              # Auto-adjust iteration limits

[task.files]
changenotes = "CHANGENOTES.md"          # Change log
issues = "IMPLEMENTATION_ISSUES.md"     # Issue tracker
questions = "OPEN_QUESTIONS.md"         # Open questions
```

All fields are optional — defaults are shown above.

### Quick Start

```bash
# 1. Generate project files from your PRD
ralph-wiggum task prd --file requirements.md

# 2. Start the development loop
ralph-wiggum task continue

# 3. Check progress at any time
ralph-wiggum task status

# 4. Add new requirements mid-project
ralph-wiggum task add --prompt "Add logging and monitoring"

# 5. Continue working on all tasks (including new ones)
ralph-wiggum task continue
```

## How It Works

1. **Prompt Injection**: Your prompt is wrapped with system instructions that tell Claude it's in an iterative loop and should only emit the promise tag when the task is truly complete.

2. **Loop Execution**: Ralph Wiggum runs `claude` with your prompt. After each iteration:
   - It checks for the completion promise in Claude's response
   - If found and minimum iterations reached, the loop ends successfully
   - Otherwise, it continues to the next iteration (starts fresh by default, use `--continue-session` to maintain conversation)

3. **State Management**: Progress is saved to a state file, allowing you to resume interrupted sessions.

4. **Graceful Shutdown**: Press `q` or `Ctrl+C` to interrupt. State is saved automatically.

## Status Bar

During execution, a status bar shows:
- Current iteration number
- Elapsed time
- Token usage (input/output)
- Cost estimate

## Exit Codes

| Code | Meaning |
|------|---------|
| `0` | Success - completion promise found |
| `1` | Error or max iterations reached |
| `130` | Interrupted by user (Ctrl+C) |

## Why "Ralph Wiggum"?

Like the character who famously says "I'm helping!", this tool keeps iterating and checking until Claude is confident the task is actually done - not just claiming to be done.

## License

MIT
